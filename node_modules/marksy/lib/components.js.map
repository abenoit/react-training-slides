{"version":3,"sources":["../src/components.js"],"names":["marksy","options","components","CodeComponent","props","createElement","className","language","dangerouslySetInnerHTML","__html","highlight","code","tracker","tree","elements","nextElementId","toc","currentId","renderer","html","presets","Object","keys","map","key","mockedReact","tag","componentProps","indexOf","assign","context","children","push","Function","e","elementId","compile","content","markedOptions","smartypants"],"mappings":"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","file":"components.js","sourcesContent":["import createRenderer from './createRenderer';\nimport marked from 'marked';\nimport {transform} from 'babel-standalone';\n\nexport function marksy (options = {}) {\n  options.components = options.components || {};\n\n  function CodeComponent (props) {\n    return options.createElement('pre', null, options.createElement('code', {\n      className: `language-${props.language}`,\n      dangerouslySetInnerHTML: {__html: options.highlight ? options.highlight(props.language, props.code) : props.code}\n    }))\n  }\n\n  const tracker = {\n    tree: null,\n    elements: null,\n    nextElementId: null,\n    toc: null,\n    currentId: []\n  };\n  const renderer = createRenderer(tracker, options, {\n    html (html) {\n      try {\n        const code = transform(html, {\n          presets: ['react']\n        }).code;\n        const components = Object.keys(options.components).map(function (key) {\n          return options.components[key];\n        });\n        const mockedReact = {createElement(tag, props = {}, ...children) {\n          const componentProps = components.indexOf(tag) >= 0 ? Object.assign(props || {}, {key: tracker.nextElementId++, context: tracker.context}) : props;\n\n          return options.createElement(tag, componentProps, children);\n        }};\n\n        tracker.tree.push(new Function('React', ...Object.keys(options.components), `return ${code}`)(mockedReact, ...components) || null);\n      } catch (e) {}\n    },\n    code (code, language) {\n      if (language === 'marksy') {\n        return renderer.html(code)\n      } else {\n        const elementId = tracker.nextElementId++;\n\n        tracker.elements[elementId] = options.createElement((options.elements && options.elements.code) || CodeComponent, {key: elementId, code, language});\n\n        tracker.tree.push(tracker.elements[elementId]);\n\n        return `{{${elementId}}}`;\n      }\n    }\n  })\n\n  return function compile (content, markedOptions = {}, context = {}) {\n    tracker.tree = [];\n    tracker.elements = {};\n    tracker.toc = [];\n    tracker.nextElementId = 0;\n    tracker.context = context;\n    tracker.currentId = [];\n    marked(content, Object.assign({renderer: renderer, smartypants: true}, markedOptions));\n\n    return {tree: tracker.tree, toc: tracker.toc};\n  };\n}\n\n\nexport default function (options) {\n  return marksy(options)\n};\n"]}